<%- include('../partials/head') %>

<main>
	<section class="container">
		<form id="form" method="post" class="d-flex d-flex-column mw-500 mg-center">
			<label for="fullname" class="mg-top-5">Full name</label>
			<input type="text" name="fullname" id="fullname" />
			<label for="email" class="mg-top-5">Email</label>
			<input type="email" name="email" id="email" />
			<label for="password" class="mg-top-5">Password</label>
			<input type="password" name="password" id="password" />
			<label for="password2" class="mg-top-5">Repeat password</label>
			<input type="password" name="password2" id="password2" />
			<input type="submit" value="Register" class="mg-top-5" />
			<div id="errors" class="warning"></div>
		</form>
	</section>
</main>

<script>
	const emailRegex =
		/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/;
	const formEl = document.getElementById('form');
	const fullnameEl = document.getElementById('fullname');
	const emailEl = document.getElementById('email');
	const passwordEl = document.getElementById('password');
	const password2El = document.getElementById('password2');
	const errorsEl = document.getElementById('errors');

	fullnameEl.value = sessionStorage.getItem('register_fullname') || '';
	emailEl.value = sessionStorage.getItem('register_email') || '';

	formEl.addEventListener('submit', (e) => {
		e.preventDefault();
		const errors = [];
		if (fullnameEl.value.length < 3 || !fullnameEl.value.includes(' '))
			errors.push('Invalid name, must be first and last name');
		if (emailEl.value.length < 4 || !emailRegex.test(emailEl.value))
			errors.push('Invalid email');
		if (passwordEl.value.length < 5 || passwordEl.value > 50)
			errors.push('Invalid password, must be between 5 and 50');
		if (passwordEl.value !== password2El.value)
			errors.push('Passwords does not match');
		errorsEl.innerText = errors.join('\n');

		if (!errors.length) {
			sessionStorage.setItem('register_fullname', fullnameEl.value);
			sessionStorage.setItem('register_email', emailEl.value);
			formEl.submit();
		}
	});
</script>

<%- include('../partials/foot') %>
