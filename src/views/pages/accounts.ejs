<%- include('../partials/head') %>

<main>
    <div class="container">
        <h1 class="text-center">Groups</h1>
        <div class="text-center">
            <div class="d-flex flex-wrap" style="justify-content: center;">
                <% if (!locals?.userGroups?.length) { %>
                    <h3>No Groups Added</h3>
                <% } else { %>
                    <% locals?.userGroups.forEach(group => { %>
                        <a href="/bills/<%= group.group_id %>" class="card">
                            <p>ID: <%= group.group_id %></p>
                            <p><%= group.name %></p>
                        </a>
                    <% }) %>
                <% } %>
            </div>
            <hr />
            <div>
                <h2>Add A Group</h2>
                <div>
                    <form action="accounts" method="post">
                        <select name="group_id" class="w-500" id="group-id-selector">
                            <option value="0" selected disabled>
                                Select a group
                            </option>
                            <% (locals?.allGroups || []).forEach(group => { %>
                                <option value="<%= group.id %>" <%= ownedGroupIds.includes(group.id) ? "disabled" : "" %>>
                                    <%= `${group.id} - ${group.name}` %>
                                </option>
                            <% }) %>
                        </select>
                        <br />
                        <input type="submit" value="Add" class="w-500  mg-top-5" id="group-add-btn" disabled/>
                        <div id="warnings" class="warning mg-top-5 w-500 inline-block text-left"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    const warningEl = document.getElementById('warnings');
    const urlParams = new URLSearchParams(window.location.search);
    const errorsParam = urlParams.get('error');
    if (errorsParam){
        warningEl.innerText = errorsParam;
    }

    const groupAddBtnEl = document.getElementById('group-add-btn');
    const groupIdSelectorEl = document.getElementById('group-id-selector');
    groupIdSelectorEl.addEventListener("change", (e) => {
        groupAddBtnEl.disabled = false;
    })

</script>

<%- include('../partials/foot') %>
